{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_INPUT\" | grep -q 'pm2 restart\\|npm start\\|node server'; then /var/www/battlefield/whole-number-miniapp/backend/scripts/fix-sequences.sh 2>/dev/null || true; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE 'git commit|git push'; then cd /var/www/battlefield/whole-number-miniapp && npm run lint --silent 2>/dev/null || echo 'Warning: Lint check skipped or has warnings'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_INPUT\" | grep -qiE 'psql.*DROP|psql.*TRUNCATE|psql.*DELETE FROM'; then echo '[Hook] Destructive DB operation - backup recommended'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_INPUT\" | grep -qiE 'rm -rf .next|rm -rf node_modules'; then echo '[Hook] Removing large directory - this may take a moment'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE 'npm run build'; then echo '[Hook] Starting build - this may take 30-60 seconds'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_INPUT\" | grep -qiE 'pg_dump|pg_restore'; then echo '[Hook] Database backup/restore operation starting'; fi"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'duplicate key.*_pkey|Failed to open trade|Failed to claim'; then echo '\\n[Hook] Sequence issue detected - run /fix-sequences'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'Build failed|error TS[0-9]+|Cannot find module'; then echo '\\n[Hook] Build error detected. Check TypeScript compilation.'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'client reference manifest.*does not exist|InvariantError'; then echo '\\n[Hook] Next.js build corruption! Run: rm -rf .next && npm run build'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'ECONNREFUSED.*5432|connection refused.*postgres'; then echo '\\n[Hook] Database connection error! Check: systemctl status postgresql'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE 'pm2 restart'; then sleep 2; if echo \"$CLAUDE_TOOL_INPUT\" | grep -q 'battlefield-backend'; then curl -s --max-time 3 http://localhost:3001/health | grep -q ok && echo '[Hook] Backend healthy' || echo '[Hook] Backend health check failed'; fi; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'errored|stopped|status.*errored'; then echo '\\n[Hook] PM2 process crashed! Check logs: pm2 logs --lines 50'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE 'pm2 list|pm2 status'; then MEM=$(pm2 jlist 2>/dev/null | grep -oP '\"memory\":\\s*\\d+' | grep -oP '\\d+' | awk '{sum+=$1} END {print int(sum/1024/1024)}'); if [ \"$MEM\" -gt 500 ]; then echo \"\\n[Hook] High memory usage: ${MEM}MB - consider restart\"; fi; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'rate limit|too many requests|429'; then echo '\\n[Hook] API rate limit detected! Wait before retrying.'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'FATAL|PANIC|out of memory|Cannot allocate'; then echo '\\n[Hook] Critical system error detected! Check server resources.'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'ENOSPC|No space left on device'; then echo '\\n[Hook] Disk full! Run /cleanup to free space.'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'SIGKILL|killed|OOMKilled'; then echo '\\n[Hook] Process killed (likely OOM). Check memory usage with /performance.'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'EADDRINUSE|address already in use'; then echo '\\n[Hook] Port already in use! Check: lsof -i :3000 or lsof -i :3001'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'permission denied|EACCES'; then echo '\\n[Hook] Permission denied. May need sudo or check file ownership.'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'npm ERR|ERESOLVE|peer dep'; then echo '\\n[Hook] NPM dependency error. Try: rm -rf node_modules package-lock.json && npm install'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'liquidat'; then LIQS=$(echo \"$CLAUDE_TOOL_OUTPUT\" | grep -ciE 'liquidat'); if [ \"$LIQS\" -gt 5 ]; then echo \"\\n[Hook] Multiple liquidations detected ($LIQS). Market may be volatile.\"; fi; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'SSL|certificate|CERT_'; then echo '\\n[Hook] SSL/Certificate issue detected. Check nginx SSL config or cert expiry.'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'Module not found|Cannot resolve'; then echo '\\n[Hook] Missing module. Run: npm install'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_INPUT\" | grep -qE 'npm run build' && echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qE 'Compiled successfully'; then echo '\\n[Hook] âœ… Build successful!'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'airdrop.*snapshot|snapshot.*airdrop'; then ELIGIBLE=$(PGPASSWORD=battlefield psql -U battlefield -h localhost -d battlefield -t -c \"SELECT COUNT(*) FROM users WHERE total_trades >= 5;\" 2>/dev/null | tr -d ' '); echo \"\\n[Hook] Airdrop check: $ELIGIBLE users eligible (5+ trades)\"; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'token.*deploy|clanker.*deploy|battle.*token'; then echo '\\n[Hook] Token deployment mentioned - run /token for launch checklist'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'merkle|merkle tree|merkle root'; then echo '\\n[Hook] Merkle tree operation - ensure snapshot is taken first with /snapshot'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'vault.*withdraw|withdraw.*vault|vesting.*release'; then echo '\\n[Hook] Vault operation detected - verify with /vault status'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'gnosis|multisig|safe.*wallet'; then echo '\\n[Hook] Multisig operation - use /wallets for wallet management'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'weekly.*reward|reward.*distribut|army.*winner'; then echo '\\n[Hook] Rewards operation - use /rewards for distribution details'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'referral.*claim|claim.*referral|referrer.*claimed|referred.*claimed'; then echo '\\n[Hook] Referral claim activity - use /referrals for status'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'fid is null|no fid|farcaster.*required|referrals are only available'; then echo '\\n[Hook] FID requirement triggered - referrals require Farcaster account'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'discrepancy|balance.*incorrect|audit.*fail'; then echo '\\n[Hook] Balance discrepancy detected - use /audit for details'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'maintenance.*enabled|trading.*disabled|maintenance mode'; then echo '\\n[Hook] Maintenance mode active - use /maintenance to check status'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'auto.*fix|fixed.*balance|balance.*corrected'; then echo '\\n[Hook] Balance fix applied - verify with /audit'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'open.*position.*cannot|has.*open.*position|close.*position.*first'; then echo '\\n[Hook] User has open positions - cannot auto-fix until closed'; fi"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE 'referral_code|referral code'; then echo '\\n[Hook] Referral link format: https://farcaster.xyz/miniapps/5kLec5hSq3bP/battlefield?ref=CODE'; fi"
          }
        ]
      }
    ]
  },
  "permissions": {
    "allow": [
      "Bash(chmod:*)"
    ]
  }
}
